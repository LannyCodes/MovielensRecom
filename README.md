# Wide & Deep ç”µå½±æ¨èç³»ç»Ÿ

åŸºäº Google Wide & Deep æ¶æ„çš„å®Œæ•´ç”µå½±æ¨èç³»ç»Ÿï¼Œä½¿ç”¨ MovieLens 10M æ•°æ®é›†ã€‚

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [Wide & Deep æ¨¡å‹è¯¦è§£](#wide--deep-æ¨¡å‹è¯¦è§£)
- [å®‰è£…ä¾èµ–](#å®‰è£…ä¾èµ–)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·è¯·æ±‚
    â†“
[å¬å›é˜¶æ®µ]
â”œâ”€â”€ çƒ­é—¨å¬å› (Top 50)
â”œâ”€â”€ ç±»å‹å¬å› (Top 100)
â””â”€â”€ ååŒè¿‡æ»¤å¬å› (Top 100)
    â†“
å€™é€‰é›†åˆå¹¶ (~200 éƒ¨ç”µå½±)
    â†“
[é‡æ’åºé˜¶æ®µ]
â””â”€â”€ Wide & Deep æ¨¡å‹ç²¾æ’
    â†“
Top-K æ¨èç»“æœ
```

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### 1. **å®Œæ•´çš„æ•°æ®å¤„ç†æµç¨‹**
- âœ… MovieLens æ•°æ®åŠ è½½ä¸è§£æ
- âœ… ç”µå½±ç±»å‹ Multi-hot ç¼–ç 
- âœ… ç”¨æˆ·ç‰¹å¾å·¥ç¨‹ï¼ˆå¹³å‡è¯„åˆ†ã€è¯„åˆ†æ ‡å‡†å·®ã€æ´»è·ƒåº¦ç­‰ï¼‰
- âœ… ç”µå½±ç‰¹å¾å·¥ç¨‹ï¼ˆæµè¡Œåº¦ã€è¯„åˆ†ç»Ÿè®¡ç­‰ï¼‰
- âœ… è´Ÿé‡‡æ ·ç”Ÿæˆè®­ç»ƒæ ·æœ¬

### 2. **Wide & Deep ç¥ç»ç½‘ç»œæ¨¡å‹**
- âœ… Wide ç»„ä»¶ï¼šçº¿æ€§æ¨¡å‹ + äº¤å‰ç‰¹å¾
- âœ… Deep ç»„ä»¶ï¼šå¤šå±‚ç¥ç»ç½‘ç»œ + Embedding
- âœ… è”åˆè®­ç»ƒä¼˜åŒ–
- âœ… æ­£åˆ™åŒ– + Dropout + BatchNormalization

### 3. **å¤šè·¯å¬å›ç­–ç•¥**
- âœ… çƒ­é—¨å¬å›ï¼šåŸºäºç”µå½±æµè¡Œåº¦
- âœ… ç±»å‹å¬å›ï¼šåŸºäºç”¨æˆ·åå¥½ç±»å‹
- âœ… ååŒè¿‡æ»¤å¬å›ï¼šåŸºäºç›¸ä¼¼ç”¨æˆ·

### 4. **ç²¾æ’é‡æ’åº**
- âœ… ä½¿ç”¨ Wide & Deep æ¨¡å‹å¯¹å€™é€‰ç”µå½±æ‰“åˆ†
- âœ… æŒ‰é¢„æµ‹åˆ†æ•°æ’åºè¿”å› Top-K

---

## ğŸ§  Wide & Deep æ¨¡å‹è¯¦è§£ (PyTorch å®ç°)

### æ¨¡å‹æ¶æ„

#### **Wide éƒ¨åˆ†ï¼ˆçº¿æ€§æ¨¡å‹ï¼‰**
```
è¾“å…¥ç‰¹å¾
â”œâ”€â”€ ç”¨æˆ·ID Ã— ç”µå½±ID äº¤å‰ç‰¹å¾
â”œâ”€â”€ ç”¨æˆ·ç»Ÿè®¡ç‰¹å¾ (4ç»´)
â”‚   â”œâ”€â”€ å¹³å‡è¯„åˆ†
â”‚   â”œâ”€â”€ è¯„åˆ†æ ‡å‡†å·®
â”‚   â”œâ”€â”€ è¯„åˆ†æ¬¡æ•°
â”‚   â””â”€â”€ æ´»è·ƒå¤©æ•°
â”œâ”€â”€ ç”µå½±ç»Ÿè®¡ç‰¹å¾ (3ç»´)
â”‚   â”œâ”€â”€ å¹³å‡è¯„åˆ†
â”‚   â”œâ”€â”€ è¯„åˆ†æ ‡å‡†å·®
â”‚   â””â”€â”€ æµè¡Œåº¦
â””â”€â”€ ç”µå½±ç±»å‹ç‰¹å¾ (multi-hot, 18ç»´)
    â†“
[çº¿æ€§å˜æ¢å±‚]
    â†“
Wide è¾“å‡º (1ç»´)
```

**ä½œç”¨**ï¼š
- è®°å¿†å†å²äº¤äº’æ¨¡å¼
- æ•è·ç›´æ¥çš„ç‰¹å¾ç»„åˆ
- æä¾›å¯è§£é‡Šæ€§

#### **Deep éƒ¨åˆ†ï¼ˆæ·±åº¦ç¥ç»ç½‘ç»œï¼‰**
```
è¾“å…¥ç‰¹å¾
â”œâ”€â”€ ç”¨æˆ·ID â†’ [Embeddingå±‚ 32ç»´] â†’ ç”¨æˆ·å‘é‡
â”œâ”€â”€ ç”µå½±ID â†’ [Embeddingå±‚ 32ç»´] â†’ ç”µå½±å‘é‡
â”œâ”€â”€ ç”¨æˆ·ç»Ÿè®¡ç‰¹å¾ (4ç»´)
â”œâ”€â”€ ç”µå½±ç»Ÿè®¡ç‰¹å¾ (3ç»´)
â””â”€â”€ ç”µå½±ç±»å‹ç‰¹å¾ (18ç»´)
    â†“
[æ‹¼æ¥å±‚] (æ‰€æœ‰ç‰¹å¾æ‹¼æ¥)
    â†“
[éšè—å±‚ 1] 256 units + ReLU + Dropout(0.3) + BatchNorm
    â†“
[éšè—å±‚ 2] 128 units + ReLU + Dropout(0.3) + BatchNorm
    â†“
[éšè—å±‚ 3] 64 units + ReLU + Dropout(0.3) + BatchNorm
    â†“
[è¾“å‡ºå±‚] 1 unit
    â†“
Deep è¾“å‡º (1ç»´)
```

**ä½œç”¨**ï¼š
- å­¦ä¹ ç‰¹å¾çš„é«˜é˜¶éçº¿æ€§ç»„åˆ
- æé«˜æ³›åŒ–èƒ½åŠ›
- å‘ç°æ½œåœ¨çš„ç”¨æˆ·-ç”µå½±å…³ç³»

#### **è”åˆè®­ç»ƒå±‚**
```
Wide è¾“å‡º (1ç»´) â”€â”€â”
                  â”œâ”€â†’ [Add] â†’ Sigmoid â†’ æœ€ç»ˆé¢„æµ‹ (0-1)
Deep è¾“å‡º (1ç»´) â”€â”€â”˜
```

**æŸå¤±å‡½æ•°**ï¼šBinary Cross-Entropy
```
Loss = -[y*log(p) + (1-y)*log(1-p)]
```

**ä¼˜åŒ–å™¨**ï¼š
- Adam (learning_rate=0.001, weight_decay=0.01)
- ReduceLROnPlateau å­¦ä¹ ç‡è°ƒåº¦
- Early Stopping (patience=3)

**è®¾å¤‡æ”¯æŒ**ï¼š
- è‡ªåŠ¨æ£€æµ‹ GPU/CPU
- æ”¯æŒ CUDA åŠ é€Ÿè®­ç»ƒ

---

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
pip install numpy pandas scikit-learn torch matplotlib seaborn
```

æˆ–ä½¿ç”¨ requirements.txtï¼š
```bash
pip install -r requirements.txt
```

### requirements.txt
```
numpy>=1.19.0
pandas>=1.1.0
scikit-learn>=0.23.0
torch>=1.8.0
matplotlib>=3.3.0
seaborn>=0.11.0
```

### GPU æ”¯æŒ

å¦‚æœæ‚¨æœ‰ NVIDIA GPUï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ GPU åŠ é€Ÿè®­ç»ƒï¼š
```python
# ä»£ç ä¼šè‡ªåŠ¨æ£€æµ‹
device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
print(f"ä½¿ç”¨è®¾å¤‡: {device}")
```

è¦å¯ç”¨ GPU æ”¯æŒï¼Œè¯·å®‰è£… CUDA ç‰ˆæœ¬çš„ PyTorchï¼š
```bash
# CUDA 11.8
pip install torch --index-url https://download.pytorch.org/whl/cu118

# CUDA 12.1
pip install torch --index-url https://download.pytorch.org/whl/cu121
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
python test_recommender.py
```

è¿™å°†ï¼š
1. åŠ è½½ MovieLens 10M æ•°æ®
2. æ„å»ºå’Œè®­ç»ƒ Wide & Deep æ¨¡å‹ï¼ˆ3 epochsï¼Œå¿«é€Ÿæµ‹è¯•ï¼‰
3. ä¸ºç¤ºä¾‹ç”¨æˆ·ç”Ÿæˆæ¨è
4. ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹

### æ–¹æ³• 2: ä½¿ç”¨ Jupyter Notebook

```bash
jupyter notebook Wide_Deep_Movie_Recommender.ipynb
```

åœ¨ Notebook ä¸­å¯ä»¥ï¼š
- æŸ¥çœ‹è¯¦ç»†çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–
- é€æ­¥ç†è§£æ¨¡å‹æ„å»ºè¿‡ç¨‹
- è°ƒæ•´è¶…å‚æ•°å¹¶å®éªŒ
- è¯„ä¼°æ¨èæ•ˆæœ

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

```
Movie Recommender Sys/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ ml-10M100K/          # MovieLens 10M æ•°æ®é›†
â”‚       â”œâ”€â”€ movies.dat       # ç”µå½±ä¿¡æ¯
â”‚       â”œâ”€â”€ ratings.dat      # è¯„åˆ†æ•°æ®
â”‚       â””â”€â”€ tags.dat         # æ ‡ç­¾æ•°æ®
â”‚
â”œâ”€â”€ wide_deep_recommender.py # æ ¸å¿ƒæ¨èç³»ç»Ÿå®ç°
â”‚   â”œâ”€â”€ DataProcessor        # æ•°æ®å¤„ç†å™¨
â”‚   â”œâ”€â”€ WideDeepModel        # Wide & Deep æ¨¡å‹
â”‚   â”œâ”€â”€ RecallEngine         # å¬å›å¼•æ“
â”‚   â”œâ”€â”€ RerankEngine         # é‡æ’åºå¼•æ“
â”‚   â””â”€â”€ MovieRecommender     # å®Œæ•´æ¨èç³»ç»Ÿ
â”‚
â”œâ”€â”€ Wide_Deep_Movie_Recommender.ipynb  # Jupyter Notebook æ•™ç¨‹
â”œâ”€â”€ test_recommender.py      # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â”œâ”€â”€ README_WideDeep.md       # æœ¬æ–‡æ¡£
â”‚
â””â”€â”€ ç”Ÿæˆçš„æ–‡ä»¶/
    â”œâ”€â”€ wide_deep_model.h5   # è®­ç»ƒå¥½çš„æ¨¡å‹
    â””â”€â”€ processor.pkl        # æ•°æ®å¤„ç†å™¨
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºæœ¬ä½¿ç”¨

```python
from wide_deep_recommender import MovieRecommender

# åˆå§‹åŒ–
recommender = MovieRecommender('./data/ml-10M100K')

# å‡†å¤‡æ•°æ®
ratings, movies, train_data, user_stats, movie_features, all_genres = recommender.prepare_data()

# è®­ç»ƒæ¨¡å‹
history = recommender.build_and_train(
    train_data, user_stats, movie_features, all_genres,
    epochs=10, batch_size=2048
)

# è®¾ç½®æ¨èå¼•æ“
recommender.setup_engines(ratings, movies, movie_features, user_stats, all_genres)

# ç”Ÿæˆæ¨è
user_id = 1
recommended_movies, scores = recommender.recommend(user_id, top_k=10)

# æ˜¾ç¤ºç»“æœ
movie_info = recommender.get_movie_info(recommended_movies, movies)
print(movie_info)
```

### 2. ä¿å­˜å’ŒåŠ è½½æ¨¡å‹

```python
# ä¿å­˜
recommender.save('my_model.pth', 'my_processor.pkl')

# åŠ è½½
new_recommender = MovieRecommender('./data/ml-10M100K')
new_recommender.load('my_model.pth', 'my_processor.pkl')
```

### 3. è‡ªå®šä¹‰å¬å›ç­–ç•¥

```python
# åªä½¿ç”¨çƒ­é—¨å¬å›
popular_movies = recommender.recall_engine.popular_recall(top_k=100)

# åªä½¿ç”¨ç±»å‹å¬å›
genre_movies = recommender.recall_engine.genre_based_recall(user_id=1, top_k=50)

# åªä½¿ç”¨ååŒè¿‡æ»¤
cf_movies = recommender.recall_engine.collaborative_recall(user_id=1, top_k=50)
```

---

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. **æ¨¡å‹è®­ç»ƒ**
- å¢åŠ  epochs åˆ° 10-20 ä»¥è·å¾—æ›´å¥½æ•ˆæœ
- è°ƒæ•´ batch_sizeï¼ˆæ ¹æ®å†…å­˜æƒ…å†µï¼š512/1024/2048ï¼‰
- å°è¯•ä¸åŒçš„ç½‘ç»œç»“æ„ï¼ˆå±‚æ•°ã€å•å…ƒæ•°ï¼‰

```python
# ç¤ºä¾‹ï¼šæ›´æ·±çš„ç½‘ç»œ
recommender.build_and_train(
    train_data, user_stats, movie_features, all_genres,
    epochs=15,
    batch_size=1024,
    deep_layers=[512, 256, 128, 64]  # è‡ªå®šä¹‰å±‚ç»“æ„
)
```

### 2. **ç‰¹å¾å·¥ç¨‹**
- æ·»åŠ æ—¶é—´ç‰¹å¾ï¼ˆè¯„åˆ†æ—¶é—´ã€å­£èŠ‚æ€§ï¼‰
- æ·»åŠ ç”¨æˆ·ç”»åƒç‰¹å¾ï¼ˆå¹´é¾„ã€æ€§åˆ«ç­‰ï¼Œå¦‚æœæ•°æ®å¯ç”¨ï¼‰
- æ·»åŠ ç”µå½±å†…å®¹ç‰¹å¾ï¼ˆå¯¼æ¼”ã€æ¼”å‘˜ã€å…³é”®è¯ç­‰ï¼‰

### 3. **å¬å›ä¼˜åŒ–**
- å¢åŠ å¬å›è·¯æ•°ï¼ˆå¦‚åŸºäºå†…å®¹ã€åŸºäºå›¾çš„å¬å›ï¼‰
- è°ƒæ•´å„è·¯å¬å›çš„æ•°é‡æ¯”ä¾‹
- å®ç°å¢é‡æ›´æ–°æœºåˆ¶

### 4. **é‡æ’ä¼˜åŒ–**
- æ·»åŠ å¤šæ ·æ€§çº¦æŸï¼ˆé¿å…æ¨èå¤ªç›¸ä¼¼çš„ç”µå½±ï¼‰
- æ·»åŠ æ–°é¢–æ€§çº¦æŸï¼ˆæ¨èå†·é—¨ä½†é«˜è´¨é‡çš„ç”µå½±ï¼‰
- è€ƒè™‘å®æ—¶ä¸Šä¸‹æ–‡ï¼ˆæ—¶é—´ã€ä½ç½®ç­‰ï¼‰

---

## ğŸ“Š è¯„ä¼°æŒ‡æ ‡

ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹æŒ‡æ ‡è¯„ä¼°ï¼š

- **AUC (Area Under Curve)**: æ¨¡å‹åŒºåˆ†èƒ½åŠ›
- **å‡†ç¡®ç‡ (Accuracy)**: é¢„æµ‹æ­£ç¡®çš„æ¯”ä¾‹
- **æŸå¤± (Loss)**: æ¨¡å‹è®­ç»ƒæŸå¤±

åœ¨ Notebook ä¸­è¿˜å¯ä»¥è®¡ç®—ï¼š
- **å¬å›ç‡@K**: Top-K ä¸­åŒ…å«ç”¨æˆ·çœŸå®å–œæ¬¢ç”µå½±çš„æ¯”ä¾‹
- **ç²¾ç¡®ç‡@K**: Top-K ä¸­ç”¨æˆ·ä¼šå–œæ¬¢çš„ç”µå½±æ¯”ä¾‹
- **NDCG@K**: è€ƒè™‘æ’åºè´¨é‡çš„å½’ä¸€åŒ–æŠ˜æŸç´¯ç§¯å¢ç›Š

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ
**A**: å‡å° batch_sizeï¼Œæˆ–è€…å‡å°‘è´Ÿé‡‡æ ·æ•°é‡ï¼Œæˆ–ä½¿ç”¨æ•°æ®é‡‡æ ·ï¼ˆåªç”¨éƒ¨åˆ†æ•°æ®è®­ç»ƒï¼‰

### Q2: è®­ç»ƒé€Ÿåº¦å¤ªæ…¢ï¼Ÿ
**A**: 
- **ä½¿ç”¨ GPU åŠ é€Ÿ**ï¼ˆæ¨èï¼ï¼‰ï¼š
  - å®‰è£… CUDA ç‰ˆæœ¬çš„ PyTorch
  - ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ GPU
  - è®­ç»ƒé€Ÿåº¦å¯æå‡ 5-10 å€
- å‡å°‘ epochs æˆ–æ•°æ®é‡
- å‡å°‘ç½‘ç»œå±‚æ•°å’Œå•å…ƒæ•°
- å¢å¤§ batch_sizeï¼ˆå¦‚æœå†…å­˜å…è®¸ï¼‰

### Q3: æ¨èæ•ˆæœä¸å¥½ï¼Ÿ
**A**: 
- å¢åŠ è®­ç»ƒè½®æ•°
- è°ƒæ•´è´Ÿé‡‡æ ·æ¯”ä¾‹
- æ·»åŠ æ›´å¤šç‰¹å¾
- è°ƒæ•´æ¨¡å‹è¶…å‚æ•°

### Q4: å¦‚ä½•å¤„ç†å†·å¯åŠ¨é—®é¢˜ï¼Ÿ
**A**: 
- æ–°ç”¨æˆ·ï¼šæ¨èçƒ­é—¨ç”µå½±
- æ–°ç”µå½±ï¼šåŸºäºå†…å®¹ç‰¹å¾æ¨è
- å¼•å…¥çŸ¥è¯†å›¾è°±æˆ–è¿ç§»å­¦ä¹ 

---

## ğŸ“š å‚è€ƒèµ„æ–™

1. **Wide & Deep Learning for Recommender Systems**
   - è®ºæ–‡ï¼šhttps://arxiv.org/abs/1606.07792
   - Google Research

2. **MovieLens æ•°æ®é›†**
   - å®˜ç½‘ï¼šhttps://grouplens.org/datasets/movielens/
   - æ–‡æ¡£ï¼šhttps://files.grouplens.org/datasets/movielens/ml-10m-README.html

3. **ç›¸å…³æ¨¡å‹**
   - DeepFM: https://arxiv.org/abs/1703.04247
   - xDeepFM: https://arxiv.org/abs/1803.05170

---

## ğŸ“ License

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æå‡ºé—®é¢˜å’Œæ”¹è¿›å»ºè®®ï¼

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ¬ğŸ¿**
